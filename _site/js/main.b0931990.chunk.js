(window.webpackJsonp=window.webpackJsonp||[]).push([[0],{15:function(t,e,a){"use strict";var n=a(1),s=a.n(n),r=a(5),i=a(3),u=a(4),c=a(9),o=a(16),l=function(){function t(e,a){if(Object(i.a)(this,t),this.json=e,this.manifest=a,this.wasm=null,this.jsglue=null,this.parameters=[],!this.json.hasOwnProperty("actor"))throw new Error("Not found required property actor");if(!this.json.actor.hasOwnProperty("wasm"))throw new Error("Not found required property actor.wasm");if(this.wasm=new c.a(this.json.actor.wasm),this.wasm.ArgName="actor.wasm",this.json.actor.hasOwnProperty("jsglue")&&(this.jsglue=new c.a(this.json.actor.jsglue),this.jsglue.ArgName="actor.jsglue"),!this.json.hasOwnProperty("parameters"))throw new Error("Not found required property parameters");for(var n in this.json.parameters){var s=new c.a(this.json.parameters[n]);s.ArgName=n,this.parameters.push(s)}}return Object(u.a)(t,[{key:"get_dependencies",value:function(){var t={status:"ok",data:[]};return t.data.push(this.wasm),this.jsglue&&t.data.push(this.jsglue),this.parameters.forEach(function(e){t.data.push(e)}),t}},{key:"eval",value:function(){var t=Object(r.a)(s.a.mark(function t(e){var a,n,r,i,u,c,l,h,d;return s.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(a={status:"",data:[]},null!==(n=e.get("actor.wasm"))){t.next=5;break}return a.status="Evaluation failed, has no actor.wasm data",t.abrupt("return",a);case 5:if(r=null,!this.jsglue){t.next=11;break}if(null!=(r=e.get("actor.jsglue"))){t.next=11;break}return a.status="Evaluation failed, has no actor.jsglue data",t.abrupt("return",a);case 11:i=[],t.t0=s.a.keys(this.parameters);case 13:if((t.t1=t.t0()).done){t.next=24;break}if(u=t.t1.value,c=this.parameters[u].ArgName,null!=(l=e.get(c))){t.next=20;break}return a.status="Evaluation failed, has no "+c+" data",t.abrupt("return",a);case 20:l.ArgName=c,i.push(l),t.next=13;break;case 24:return h=new o.a(n,r),t.next=27,h.init();case 27:if("ok"!==(a=t.sent).status){t.next=33;break}return t.next=31,h.exec(i);case 31:"ok"===(a=t.sent).status&&this.manifest&&"ok"===(d=this.manifest.get_mime()).status&&(a.data.MIME=d.data);case 33:return t.abrupt("return",a);case 34:case"end":return t.stop()}},t,this)}));return function(e){return t.apply(this,arguments)}}()}]),t}();e.a=l},16:function(t,e,a){"use strict";(function(t){var n=a(1),s=a.n(n),r=a(5),i=a(3),u=a(4),c=function(){function e(t,a){Object(i.a)(this,e),this.raw_wasm=t,this.jsglue=a,this.wasm=null,this.wasm_memory=null}return Object(u.a)(e,[{key:"init",value:function(){var t=Object(r.a)(s.a.mark(function t(){var e,a,n,r,i,u=this;return s.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(e={status:"ok"},t.prev=1,null!==this.wasm){t.next=19;break}if(null!==this.jsglue){t.next=14;break}return t.next=6,new WebAssembly.compile(this.raw_wasm);case 6:return a=t.sent,t.next=9,new WebAssembly.instantiate(a,[]);case 9:n=t.sent,this.wasm=n.exports,this.wasm_memory=this.wasm.memory,t.next=19;break;case 14:return r=this.stringFromUTF8Array(this.jsglue),i=Function('"use strict";'+r+"return Module;")(),t.next=18,new Promise(function(t,e){u.wasm=new i({wasmBinary:u.raw_wasm,onRuntimeInitialized:function(){t("onRuntimeInitialized")}})});case 18:this.wasm_memory=this.wasm.wasmMemory;case 19:t.next=24;break;case 21:t.prev=21,t.t0=t.catch(1),e.status=this.create_error("Exception while init: "+t.t0);case 24:return t.abrupt("return",e);case 25:case"end":return t.stop()}},t,this,[[1,21]])}));return function(){return t.apply(this,arguments)}}()},{key:"exec",value:function(){var e=Object(r.a)(s.a.mark(function e(a){var n,r,i,u,c,o,l,h,d,f,m,p,b,v,_,k,g,y;return s.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n={status:"",data:[]},e.prev=1,e.next=4,this.init();case 4:if("ok"!==(r=e.sent).status){e.next=44;break}e.t0=s.a.keys(a);case 7:if((e.t1=e.t0()).done){e.next=41;break}if(i=e.t1.value,null!=a[i]){e.next=12;break}return n.status=this.create_error("Wrong usage, one of arguments is empty"),e.abrupt("return",n);case 12:if(u=0,a[i].hasOwnProperty("ArgName")){e.next=16;break}return n.status=this.create_error("Wrong usage, one of arguments has no 'ArgName' property"),e.abrupt("return",n);case 16:if(c=new Uint8Array(t.from(a[i].ArgName)),o=c.length,0===(l=this.wasm._set_arg_name(i,c.length))){e.next=28;break}for(h=new Uint8ClampedArray(this.wasm_memory.buffer,l,o),d=0;d<h.length;d++)h[d]=c[d];if(0!==(u=this.wasm._get_arg_index(i))){e.next=26;break}return n.status=this.create_last_error(),e.abrupt("return",n);case 26:e.next=30;break;case 28:return n.status=this.create_last_error(),e.abrupt("return",n);case 30:if(f=a[i].length,0===(m=this.wasm._set_arg(u,f))){e.next=37;break}for(p=new Uint8ClampedArray(this.wasm_memory.buffer,m,f),b=0;b<p.length;b++)p[b]=a[i][b];e.next=39;break;case 37:return n.status=this.create_last_error(),e.abrupt("return",n);case 39:e.next=7;break;case 41:if(this.wasm._exec())if(v=this.wasm._get_result_size(),0!==(_=this.wasm._get_result())){for(k=[],g=new Uint8ClampedArray(this.wasm_memory.buffer,_,v),y=0;y<g.length;y++)k.push(g[y]);n.status="ok",n.data=k}else n.status=this.create_last_error();else n.status=this.create_last_error();e.next=45;break;case 44:n.status=this.create_error("Init error: "+r.status);case 45:e.next=50;break;case 47:e.prev=47,e.t2=e.catch(1),n.status=this.create_error("Exception while exec: "+e.t2);case 50:return e.abrupt("return",n);case 51:case"end":return e.stop()}},e,this,[[1,47]])}));return function(t){return e.apply(this,arguments)}}()},{key:"create_error",value:function(t){return t}},{key:"create_last_error",value:function(){for(var t=[],e=this.wasm._get_last_error(),a=this.wasm._get_last_error_size(),n=new Uint8ClampedArray(this.wasm_memory.buffer,e,a),s=0;s<n.length;s++)t.push(n[s]);return this.create_error(this.stringFromUTF8Array(t))}},{key:"stringFromUTF8Array",value:function(t){for(var e=[1,1,1,1,2,2,3,0],a=t.length,n="",s=0;s<a;){var r=t[s++];if(128&r){var i=e[r>>3&7];if(!(64&r)||!i||s+i>a)return null;for(r&=63>>i;i>0;i-=1){var u=t[s++];if(128!==(192&u))return null;r=r<<6|63&u}}n+=String.fromCharCode(r)}return n}}]),e}();e.a=c}).call(this,a(14).Buffer)},17:function(t,e,a){t.exports=a(29)},22:function(t,e,a){},23:function(t,e,a){},29:function(t,e,a){"use strict";a.r(e);var n=a(0),s=a.n(n),r=a(10),i=a.n(r),u=(a(22),a(3)),c=a(4),o=a(8),l=a(6),h=a(7),d=a(2),f=(a(23),function(t){function e(t){var a;return Object(u.a)(this,e),(a=Object(o.a)(this,Object(l.a)(e).call(this,t))).state={cache:t.cache,updateApp:t.updateApp},a.handleCacheOper=a.handleCacheOper.bind(Object(d.a)(Object(d.a)(a))),a}return Object(h.a)(e,t),Object(c.a)(e,[{key:"handleCacheOper",value:function(t){this.state.cache[t.target.name](t.target.value)&&this.state.updateApp()}},{key:"strDigest",value:function(t){var e=t;return"string"!==typeof t&&(e=new Uint8Array(t).toString()),e.length>20?e.substr(0,10)+"..."+e.substr(e.length-10,10):e}},{key:"render",value:function(){var t=this,e=this.state.cache,a=e.get_cached_manifests(),n=e.get_cached_data(),r=a.map(function(e){return s.a.createElement("tr",null,s.a.createElement("td",{title:e.doi},t.strDigest(e.doi)),s.a.createElement("td",{title:JSON.stringify(e.value)},t.strDigest(JSON.stringify(e.value))),s.a.createElement("td",null,s.a.createElement("button",{onClick:t.handleCacheOper,name:"delete_manifest_by_doi",value:e.doi},"X")))}),i=n.map(function(e){return s.a.createElement("tr",null,s.a.createElement("td",{title:e.doi},t.strDigest(e.doi)),s.a.createElement("td",{title:e.value},t.strDigest(e.value)," (",e.value.length,")"),s.a.createElement("td",null,s.a.createElement("button",{onClick:t.handleCacheOper,name:"delete_data_by_doi",value:e.doi},"X")))});return s.a.createElement("div",{className:"Cache"},s.a.createElement("table",{border:"1",width:"100%"},s.a.createElement("th",null,"Cache ",s.a.createElement("button",{onClick:this.handleCacheOper,name:"clear",value:"()"},"Clear")),s.a.createElement("tr",null,s.a.createElement("table",{border:"1",width:"100%"},s.a.createElement("th",null,"Entity type"),s.a.createElement("th",null,"Count"),s.a.createElement("tr",null,s.a.createElement("td",null,"Manifest"),s.a.createElement("td",null,e.get_cached_manifests_size())),s.a.createElement("tr",null,s.a.createElement("td",null,"Data"),s.a.createElement("td",null,e.get_cached_data_size()))),s.a.createElement("table",{border:"1",width:"100%"},s.a.createElement("tr",null,s.a.createElement("th",null,"DOI"),s.a.createElement("th",null,"Manifest"),s.a.createElement("th",null,"Delete")),r),s.a.createElement("table",{border:"1",width:"100%"},s.a.createElement("tr",null,s.a.createElement("th",null,"DOI"),s.a.createElement("th",null,"Data"),s.a.createElement("th",null,"Delete")),i))))}}]),e}(n.Component)),m=a(1),p=a.n(m),b=a(11),v=a(5),_=function(t){function e(t){var a;return Object(u.a)(this,e),(a=Object(o.a)(this,Object(l.a)(e).call(this,t))).state={network:t.network,updateApp:t.updateApp,fetchManifestResult:"",fetchDataResult:"",doi:""},a.handleFetch=a.handleFetch.bind(Object(d.a)(Object(d.a)(a))),a.handleDOIChange=a.handleDOIChange.bind(Object(d.a)(Object(d.a)(a))),a}return Object(h.a)(e,t),Object(c.a)(e,[{key:"handleDOIChange",value:function(t){this.setState({doi:t.target.value})}},{key:"handleFetch",value:function(){var t=Object(v.a)(p.a.mark(function t(e){var a,n=this;return p.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(a=e.target.value,""!==this.state.doi){t.next=4;break}return this.setState(Object(b.a)({},a,"Empty DOI")),t.abrupt("return");case 4:this.state.network[e.target.name](this.state.doi).then(function(t){n.setState(Object(b.a)({},a,t.status)),"ok"===t.status&&n.state.updateApp()});case 5:case"end":return t.stop()}},t,this)}));return function(e){return t.apply(this,arguments)}}()},{key:"render",value:function(){return s.a.createElement("div",{className:"Network"},s.a.createElement("datalist",{id:"dois"},s.a.createElement("option",{value:"03FEE1468FF693744FDEFB20D41E793E6A03CFBDD3687901EA99271DCC702DF8"}),s.a.createElement("option",{value:"00A66067BD93F5417D9E94858795B6E852EF90DE790C543B1E47A2E009D435F3"}),s.a.createElement("option",{value:"0487DEB729ABE42001007D1ADBEF310FE6BCBD308B7A889458F2E1F8B1C5D14E"})),s.a.createElement("table",{border:"1",width:"100%"},s.a.createElement("th",null,"Network"),s.a.createElement("tr",null,s.a.createElement("table",{border:"1",width:"100%"},s.a.createElement("tr",null,s.a.createElement("td",null,"DOI ",s.a.createElement("input",{type:"text",onChange:this.handleDOIChange,list:"dois"})),s.a.createElement("td",null)),s.a.createElement("tr",null,s.a.createElement("td",null,s.a.createElement("button",{onClick:this.handleFetch,name:"search_manifest_by_doi",value:"fetchManifestResult"},"Fetch Manifest")),s.a.createElement("td",null,this.state.fetchManifestResult)),s.a.createElement("tr",null,s.a.createElement("td",null,s.a.createElement("button",{onClick:this.handleFetch,name:"search_data_by_doi",value:"fetchDataResult"},"Fetch Data")),s.a.createElement("td",null,this.state.fetchDataResult))))))}}]),e}(n.Component),k=function(t){function e(t){var a;return Object(u.a)(this,e),(a=Object(o.a)(this,Object(l.a)(e).call(this,t))).state={application:t.application,updateApp:t.updateApp,formula:t.formula,cache:t.application.engine.cache(),network:t.application.engine.network(),evalResult:"No evaluation result"},a.handleEval=a.handleEval.bind(Object(d.a)(Object(d.a)(a))),a}return Object(h.a)(e,t),Object(c.a)(e,[{key:"handleEval",value:function(t){var e=this;this.state.application.engine.eval(this.state.formula).then(function(t){e.setState({evalResult:t.status}),e.state.updateApp()})}},{key:"getDependencies",value:function(){var t=this,e=this.props.formula.get_dependencies();return 0===e.data.length?"ok"!==e.status?"Error getting dependency: "+e.status:"Has no dependency":e.data.map(function(e){return s.a.createElement("div",null,s.a.createElement("tr",null,s.a.createElement("td",null,e.ArgName),s.a.createElement("td",null,s.a.createElement(g,{application:t.state.application,updateApp:t.state.updateApp,manifest:{data:e,status:"ok"}}))))})}},{key:"render",value:function(){return s.a.createElement("div",{className:"Formula"},s.a.createElement("tr",null,s.a.createElement("td",null,s.a.createElement("button",{onClick:this.handleEval},"Evaluate Formula")),s.a.createElement("td",null,this.state.evalResult)),this.getDependencies())}}]),e}(n.Component),g=function(t){function e(t){var a;return Object(u.a)(this,e),(a=Object(o.a)(this,Object(l.a)(e).call(this,t))).state={application:t.application,updateApp:t.updateApp,cache:t.application.engine.cache(),network:t.application.engine.network(),manifest:t.manifest,init_manifest:t.manifest,rootManifest:t.rootManifest},a.handleFetchManifest=a.handleFetchManifest.bind(Object(d.a)(Object(d.a)(a))),a.handleRemoveManifest=a.handleRemoveManifest.bind(Object(d.a)(Object(d.a)(a))),a.handleFetchData=a.handleFetchData.bind(Object(d.a)(Object(d.a)(a))),a.handleRemoveData=a.handleRemoveData.bind(Object(d.a)(Object(d.a)(a))),a.state.rootManifest&&(a.updateManifest=a.updateManifest.bind(Object(d.a)(Object(d.a)(a))),a.state.application.setUpdateManifest(a.updateManifest)),a.handleChangeManifestFocus=a.handleChangeManifestFocus.bind(Object(d.a)(Object(d.a)(a))),a}return Object(h.a)(e,t),Object(c.a)(e,[{key:"handleChangeManifestFocus",value:function(){this.state.rootManifest?this.state.application.PopManifestFocusList():this.state.application.PushManifestFocusList(this.state.manifest)}},{key:"updateManifest",value:function(){this.setState({manifest:this.state.application.getCurrentManifest(),init_manifest:this.state.application.getCurrentManifest()})}},{key:"handleFetchManifest",value:function(t){var e=this;this.state.network.search_manifest_by_doi(t.target.value).then(function(t){"ok"===t.status&&(e.setState({manifest:t}),e.state.updateApp())})}},{key:"handleRemoveManifest",value:function(t){this.state.cache.delete_manifest_by_doi(t.target.value)&&(this.setState({manifest:this.state.init_manifest}),this.state.updateApp())}},{key:"handleFetchData",value:function(t){var e=this;this.state.network.search_data_by_doi(t.target.value).then(function(t){if("ok"===t.status){var a=e.state.manifest;a.rawData=t.data,e.setState({manifest:a})}e.state.updateApp()})}},{key:"handleRemoveData",value:function(t){if(this.state.cache.delete_data_by_doi(t.target.value)){var e=this.state.manifest;e.rawData=null,this.setState({manifest:e}),this.state.updateApp()}}},{key:"getManifestHeader",value:function(){var t="Has no DOI",e=this.state.manifest.data.get_doi();if("ok"===e.status){var a=e.data[0],n=this.state.cache.get_manifest_by_doi(a);"ok"===n.status?this.state.manifest=n:this.state.manifest=this.state.init_manifest;var s=this.state.cache.get_data_by_doi(a);"ok"===s.status?this.state.manifest.rawData=s.data:this.state.manifest.rawData=null;var r="ok"===this.state.manifest.data.get_mime().status?"MIME='"+this.state.manifest.data.get_mime().data+"'":this.state.manifest.data.get_mime().status,i="ok"===this.state.manifest.data.get_size().status?"size="+this.state.manifest.data.get_size().data:this.state.manifest.data.get_size().status;if(t=a.length>10?a.substr(0,10)+"..."+a.substr(a.length-10,10)+" ("+r+", "+i:a+" ("+r+", "+i,null!=this.state.manifest.rawData){var u=new Uint8Array(this.state.manifest.rawData).toString();t=t+", Data="+u.substr(0,10)+"..."+u.substr(u.length-10,10)}else t+=", Has no data";t+=")"}return t}},{key:"getManifestControls",value:function(){var t="",e=this.state.manifest.data.get_doi();if("ok"===e.status){var a=e.data[0],n="";n="ok"===this.state.cache.get_manifest_by_doi(a).status?s.a.createElement("div",null,s.a.createElement("button",{onClick:this.handleRemoveManifest,value:a},"Remove Manifest")):s.a.createElement("div",null,s.a.createElement("button",{onClick:this.handleFetchManifest,value:a},"Fetch Manifest"));var r="";r="ok"===this.state.cache.get_data_by_doi(a).status?s.a.createElement("div",null,s.a.createElement("button",{onClick:this.handleRemoveData,value:a},"Remove Data")):s.a.createElement("div",null,s.a.createElement("button",{onClick:this.handleFetchData,value:a},"Fetch Data")),t=s.a.createElement("div",null,s.a.createElement("tr",null,s.a.createElement("td",null,n),s.a.createElement("td",null,r)))}return t}},{key:"getManifestFormulas",value:function(){var t=this,e=this.state.manifest.data.get_formulas();return 0===e.data.length?"ok"!==e.status?"Error getting formulas: "+e.status:"Has no formulas":e.data.map(function(e){return s.a.createElement("div",null,s.a.createElement("table",{border:"1",width:"100%"},s.a.createElement(k,{application:t.state.application,updateApp:t.state.updateApp,formula:e})))})}},{key:"render",value:function(){if(null==this.state.manifest||"ok"!==this.state.manifest.status){var t=null!=this.state.manifest?this.state.manifest.status:"Not defined";return s.a.createElement("div",{className:"Manifest"},s.a.createElement("table",{border:"1",width:"100%"},s.a.createElement("th",null,"Manifest"),s.a.createElement("tr",null,t)))}var e=s.a.createElement("button",{onClick:this.handleChangeManifestFocus},"focus in");return this.state.rootManifest&&(e=!1===this.state.application.ManifestFocusListIsEmpty()?s.a.createElement("button",{onClick:this.handleChangeManifestFocus},"focus out"):""),s.a.createElement("div",{className:"Manifest"},s.a.createElement("table",{border:"1",width:"100%"},s.a.createElement("th",null,"Manifest -> ",this.getManifestHeader()," ",e),s.a.createElement("tr",null,this.getManifestControls()),s.a.createElement("tr",null,this.getManifestFormulas())))}}]),e}(n.Component),y=function(t){function e(t){var a;return Object(u.a)(this,e),(a=Object(o.a)(this,Object(l.a)(e).call(this,t))).state={application:t.application,cache:t.application.getCache(),network:t.application.getNetwork()},a.updateApp=a.updateApp.bind(Object(d.a)(Object(d.a)(a))),a}return Object(h.a)(e,t),Object(c.a)(e,[{key:"updateApp",value:function(){this.forceUpdate()}},{key:"render",value:function(){return s.a.createElement("div",{className:"App"},s.a.createElement(g,{application:this.state.application,updateApp:this.updateApp,manifest:this.state.application.getCurrentManifest(),rootManifest:!0}),"-",s.a.createElement(f,{cache:this.state.cache,updateApp:this.updateApp}),"-",s.a.createElement(_,{network:this.state.network,updateApp:this.updateApp}))}}]),e}(n.Component);Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));var w=function(){function t(e){Object(u.a)(this,t),this.address=e}return Object(c.a)(t,[{key:"get_manifest_by_doi",value:function(){var t=Object(v.a)(p.a.mark(function t(e){var a,n,s,r;return p.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return a={status:"",data:null},n=this.address+"/search?doi="+e,t.prev=2,t.next=5,fetch(n);case 5:if(s=t.sent,t.prev=6,200!==s.status){t.next=15;break}return t.next=10,s.json();case 10:r=t.sent,a.data=r,a.status="ok",t.next=16;break;case 15:a.status="Response error: "+s.statusText;case 16:t.next=21;break;case 18:t.prev=18,t.t0=t.catch(6),a.status="Error parsing request ("+t.t0+")";case 21:t.next=26;break;case 23:t.prev=23,t.t1=t.catch(2),a.status="Error requesting server ("+t.t1+")";case 26:return t.abrupt("return",a);case 27:case"end":return t.stop()}},t,this,[[2,23],[6,18]])}));return function(e){return t.apply(this,arguments)}}()},{key:"get_data_by_doi",value:function(){var t=Object(v.a)(p.a.mark(function t(e){var a,n,s,r;return p.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return a={status:"",data:null},n=this.address+"/raw/"+e,t.prev=2,t.next=5,fetch(n);case 5:if(200!==(s=t.sent).status){t.next=14;break}return t.next=9,s.arrayBuffer();case 9:r=t.sent,a.data=r,a.status="ok",t.next=15;break;case 14:a.status="Response error: "+s.statusText;case 15:t.next=20;break;case 17:t.prev=17,t.t0=t.catch(2),a.status="Error requesting server ("+t.t0+")";case 20:return t.abrupt("return",a);case 21:case"end":return t.stop()}},t,this,[[2,17]])}));return function(e){return t.apply(this,arguments)}}()}]),t}(),E=a(9),j=function(){function t(e,a){if(Object(u.a)(this,t),this.Cache=a,!e.hasOwnProperty("DedicatedServer"))throw new Error("Bad network settings");this.DedicatedServer=new w(e.DedicatedServer)}return Object(c.a)(t,[{key:"search_manifest",value:function(){var t=Object(v.a)(p.a.mark(function t(e){var a,n,s,r;return p.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(a={status:"Not found",source:null,data:null},0!==(n=e.get_doi()).data.length){t.next=5;break}return a.status="Manifest has no doi",t.abrupt("return",a);case 5:if(!this.DedicatedServer){t.next=22;break}t.t0=p.a.keys(n.data);case 7:if((t.t1=t.t0()).done){t.next=22;break}return s=t.t1.value,t.next=11,this.search_manifest_by_doi(n.data[s]);case 11:if("ok"!==(r=t.sent).status){t.next=19;break}return a.status="ok",a.source=r.source,a.data=r.data,t.abrupt("return",a);case 19:a.status=r.status;case 20:t.next=7;break;case 22:return t.abrupt("return",a);case 23:case"end":return t.stop()}},t,this)}));return function(e){return t.apply(this,arguments)}}()},{key:"search_manifest_by_doi",value:function(){var t=Object(v.a)(p.a.mark(function t(e){var a,n,s,r;return p.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(a={status:"",source:null,data:null},!this.DedicatedServer){t.next=15;break}if("ok"!==(n=this.Cache.get_manifest_by_doi(e)).status){t.next=9;break}a.status="ok",a.source="Cache",a.data=n.data,t.next=13;break;case 9:return t.next=11,this.DedicatedServer.get_manifest_by_doi(e);case 11:if("ok"===(s=t.sent).status)try{r=new E.a(s.data),a.status="ok",a.source="Network",a.data=r,this.Cache.set_manifest_by_doi(r,e)}catch(i){a.status="Not valid manifest ("+i+")"}else a.status=s.status;case 13:t.next=16;break;case 15:a.status="Not implimented";case 16:return t.abrupt("return",a);case 17:case"end":return t.stop()}},t,this)}));return function(e){return t.apply(this,arguments)}}()},{key:"search_data",value:function(){var t=Object(v.a)(p.a.mark(function t(e){var a,n,s,r;return p.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(a={status:"Not found",source:null,data:null},0!==(n=e.get_doi()).data.length){t.next=5;break}return a.status="Manifest has no doi",t.abrupt("return",a);case 5:if(!this.DedicatedServer){t.next=22;break}t.t0=p.a.keys(n.data);case 7:if((t.t1=t.t0()).done){t.next=22;break}return s=t.t1.value,t.next=11,this.search_data_by_doi(n.data[s]);case 11:if("ok"!==(r=t.sent).status){t.next=19;break}return a.status="ok",a.source=r.source,a.data=r.data,t.abrupt("return",a);case 19:a.status=r.status;case 20:t.next=7;break;case 22:return t.abrupt("return",a);case 23:case"end":return t.stop()}},t,this)}));return function(e){return t.apply(this,arguments)}}()},{key:"search_data_by_doi",value:function(){var t=Object(v.a)(p.a.mark(function t(e){var a,n,s;return p.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(a={status:"",source:null,data:null},!this.DedicatedServer){t.next=22;break}if("ok"!==(n=this.Cache.get_data_by_doi(e)).status){t.next=8;break}return a.status="ok",a.source="Cache",a.data=n.data,t.abrupt("return",a);case 8:return t.next=10,this.DedicatedServer.get_data_by_doi(e);case 10:if("ok"!==(s=t.sent).status){t.next=19;break}return a.status="ok",a.source="Network",a.data=s.data,this.Cache.set_data_by_doi(s.data,e),t.abrupt("return",a);case 19:a.status=s.status;case 20:t.next=23;break;case 22:a.status="Not implimented";case 23:return t.abrupt("return",a);case 24:case"end":return t.stop()}},t,this)}));return function(e){return t.apply(this,arguments)}}()}]),t}(),O=function(){function t(){Object(u.a)(this,t),this.manifests=new Map,this.data=new Map}return Object(c.a)(t,[{key:"get_manifest_by_doi",value:function(t){var e={status:"Not found",data:null},a=this.manifests.get(t);return a&&(e.status="ok",e.data=a),e}},{key:"set_manifest_by_doi",value:function(t,e){this.manifests.set(e,t)}},{key:"delete_manifest_by_doi",value:function(t){return this.manifests.delete(t)}},{key:"get_data_by_doi",value:function(t){var e={status:"Not found",data:null},a=this.data.get(t);return a&&(e.status="ok",e.data=a),e}},{key:"get_data_by_manifest",value:function(t){var e={status:"Not found",data:null},a=t.get_doi();if("ok"===a.status)for(var n in a.data){var s=this.data.get(a.data[n]);if(s)return e.status="ok",e.data=s,e}else e.status="Manifest has no doi";return e}},{key:"set_data_by_doi",value:function(t,e){this.data.set(e,new Uint8Array(t))}},{key:"delete_data_by_doi",value:function(t){return this.data.delete(t)}},{key:"clear",value:function(){var t=this.manifests.size+this.data.size;return this.manifests.clear(),this.data.clear(),0!==t}},{key:"get_cached_manifests",value:function(){var t=[];return this.manifests.forEach(function(e,a){t.push({doi:a,value:e})}),t}},{key:"get_cached_manifests_size",value:function(){return this.manifests.size}},{key:"get_cached_data",value:function(){var t=[];return this.data.forEach(function(e,a){t.push({doi:a,value:e})}),t}},{key:"get_cached_data_size",value:function(){return this.data.size}}]),t}(),x=function(){function t(e){if(Object(u.a)(this,t),this.Cache=new O,!e.hasOwnProperty("Network"))throw new Error("Bad engine settings");this.Network=new j(e.Network,this.Cache)}return Object(c.a)(t,[{key:"network",value:function(){return this.Network}},{key:"cache",value:function(){return this.Cache}},{key:"eval",value:function(){var t=Object(v.a)(p.a.mark(function t(e){var a,n,s,r,i,u,c,o,l,h,d;return p.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(a={status:"",source:null,data:[]},n=null,!e.manifest){t.next=17;break}if("ok"!==(s=e.manifest.get_doi()).status){t.next=17;break}t.t0=p.a.keys(s.data);case 6:if((t.t1=t.t0()).done){t.next=17;break}if(r=t.t1.value,n=s.data[r],"ok"!==(i=this.Cache.get_data_by_doi(n)).status){t.next=15;break}return a.status="ok",a.source="Cache",a.data=i.data,t.abrupt("return",a);case 15:t.next=6;break;case 17:if(u=new Map,"ok"!==(c=e.get_dependencies()).status){t.next=37;break}t.t2=p.a.keys(c.data);case 21:if((t.t3=t.t2()).done){t.next=35;break}return o=t.t3.value,l=c.data[o],t.next=26,this.Cache.get_data_by_manifest(l);case 26:if("ok"!==(h=t.sent).status){t.next=31;break}u.set(l.ArgName,h.data),t.next=33;break;case 31:return a.status="Cache has no data for dependency: "+l.ArgName,t.abrupt("return",a);case 33:t.next=21;break;case 35:t.next=39;break;case 37:return a.status="Formula has no dependencies",t.abrupt("return",a);case 39:return t.next=41,e.eval(u);case 41:return"ok"===(d=t.sent).status?(a.status="ok",a.source="Evaluation",a.data=d.data,n&&this.Cache.set_data_by_doi(d.data,n)):a.status="Error evaluation formula ("+d.status+")",t.abrupt("return",a);case 44:case"end":return t.stop()}},t,this)}));return function(e){return t.apply(this,arguments)}}()}]),t}(),M=function(){function t(e){Object(u.a)(this,t);var a={Network:{DedicatedServer:e}};this.engine=new x(a),this.update_manifest=null,this.current_manifest=null,this.current_manifest_status="Not defined",this.manifest_focus_list=[]}return Object(c.a)(t,[{key:"setUpdateManifest",value:function(t){this.update_manifest=t}},{key:"getCache",value:function(){return this.engine.cache()}},{key:"getNetwork",value:function(){return this.engine.network()}},{key:"getCurrentManifest",value:function(){var t={status:"ok",data:null};return t.data=this.current_manifest,t.status=this.current_manifest_status,t}},{key:"setNewManifest",value:function(t){this.manifest_focus_list=[],this.current_manifest=null,this.current_manifest_status="Not defined";try{this.current_manifest=new E.a(JSON.parse(t)),this.current_manifest_status="ok"}catch(e){this.current_manifest_status="Error creating manifest: "+e}null!==this.update_manifest&&this.update_manifest()}},{key:"PushManifestFocusList",value:function(t){0===this.manifest_focus_list.length&&this.manifest_focus_list.push({data:this.current_manifest,status:this.current_manifest_status}),this.manifest_focus_list.push({data:t.data,status:t.status}),this.current_manifest=t.data,this.current_manifest_status=t.status,null!==this.update_manifest&&this.update_manifest()}},{key:"PopManifestFocusList",value:function(){var t=this.manifest_focus_list.pop();null!=t&&null!=(t=this.manifest_focus_list.pop())&&(this.current_manifest=t.data,this.current_manifest_status=t.status,null!==this.update_manifest&&this.update_manifest())}},{key:"ManifestFocusListIsEmpty",value:function(){return 0===this.manifest_focus_list.length}}]),t}(),C=function(t){function e(t){var a;return Object(u.a)(this,e),(a=Object(o.a)(this,Object(l.a)(e).call(this,t))).state={application:t.application,textAreaID:t.textAreaID},a.actionClick=a.actionClick.bind(Object(d.a)(Object(d.a)(a))),a}return Object(h.a)(e,t),Object(c.a)(e,[{key:"actionClick",value:function(t){var e=document.getElementById(this.state.textAreaID).value;this.state.application.setNewManifest(e)}},{key:"render",value:function(){return s.a.createElement("button",{onClick:this.actionClick},"Manifest to App")}}]),e}(n.Component),D=new M("https://kolmonet-server-238514.appspot.com");i.a.render(s.a.createElement(y,{application:D}),document.getElementById("root")),document.querySelectorAll("div.interactive-canvas").forEach(function(t){var e=t.querySelector("textarea.manifest-text").id,a=t.querySelector("span.run-button-placeholder");i.a.render(s.a.createElement(C,{application:D,textAreaID:e}),a)}),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then(function(t){t.unregister()})},9:function(t,e,a){"use strict";(function(t){var n=a(3),s=a(4),r=a(15),i=function(){function e(t){Object(n.a)(this,e),this.json=t}return Object(s.a)(e,[{key:"get_mime",value:function(){var t={status:"Has no MIME",data:null};return this.json.hasOwnProperty("MIME")&&(t.status="ok",t.data=this.json.MIME),t}},{key:"get_size",value:function(){var t={status:"Has no size",data:null};return this.json.hasOwnProperty("size")&&(t.status="ok",t.data=this.json.size),t}},{key:"get_raw_value",value:function(){var e={status:"Has no raw",data:[]};return this.json.hasOwnProperty("raw")&&(e.status="ok",e.data=new Uint8Array(t.from(this.json.raw)),this.json.hasOwnProperty("MIME")&&(e.data.MIME=this.json.MIME)),e}},{key:"get_doi",value:function(){var t={status:"ok",data:[]};if(this.json.hasOwnProperty("doi"))for(var e in this.json.doi)t.data.push(this.json.doi[e]);return t}},{key:"get_formulas",value:function(){var t=this,e={status:"",data:[]};return this.json.hasOwnProperty("formulas")&&this.json.formulas.forEach(function(a){try{e.data.push(new r.a(a,t))}catch(n){e.status+="Error creating formula ("+n+") "}}),""===e.status&&(e.status="ok"),e}}]),e}();e.a=i}).call(this,a(14).Buffer)}},[[17,1,2]]]);
//# sourceMappingURL=main.b0931990.chunk.js.map